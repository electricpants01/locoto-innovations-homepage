---
import { getAllStudents } from "@lib/students";

// Extract the search query from the URL
const params = Astro.url.searchParams;
const studentSearchName = params.get("name") || "";

// Fetch students based on the search query
const students = await getAllStudents(studentSearchName);
---

<div class="container mx-auto p-6">
    <div class="flex flex-col items-center mb-8">
        <div class="flex w-full max-w-md">
            <input
              id="searchInput"
              type="text"
              placeholder="Type something..."
              value={studentSearchName}
              class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-blue-200 focus:outline-none"
            />
            <button
              id="searchButton"
              class="ml-4 px-4 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none"
            >
                Submit
            </button>
        </div>
    </div>

    <!-- Cards -->
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {students.map((card: any) => (
          <div
            class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200"
          >
              <h2 class="text-xl font-semibold text-gray-800 mb-2">{card.fullName}</h2>
              <p class="text-gray-600">{card.registro}</p>
              <p class="text-gray-600">{card.carr}</p>
              <p class="text-gray-600">{card.telefono}</p>
              <p class="text-gray-600">{card.carrera}</p>
              <p class="text-gray-600">{card.ubicacion}</p>
              <p class="text-gray-600">{card.fecha_nac}</p>
              <p class="text-gray-600">{card.sexo}</p>
              <p class="text-gray-600">{card.ci}</p>
          </div>
        ))}
    </div>
</div>

<script>
    // Add event listener to handle the search
    const searchButton = document.getElementById("searchButton");
    if (searchButton) {
        searchButton.addEventListener("click", () => {
            const searchInput = document.getElementById("searchInput") as HTMLInputElement | null;
            if (!searchInput) return; // Ensure the input element exists

            const searchValue = searchInput.value.trim();

            // Update the URL with the search query and reload the page
            const currentUrl = new URL(window.location.href);
            if (searchValue) {
                currentUrl.searchParams.set("name", searchValue);
            } else {
                currentUrl.searchParams.delete("name");
            }
            window.location.href = currentUrl.toString();
        });
    }
</script>
